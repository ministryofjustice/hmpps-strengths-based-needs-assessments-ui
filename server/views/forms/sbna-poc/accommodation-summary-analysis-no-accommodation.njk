{% extends "../layout.njk" %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/radios/macro.njk" import govukRadios %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/tabs/macro.njk" import govukTabs %}
{% from "components/question/macro.njk" import renderQuestion %}
{% from "components/summary/accommodation/macro.njk" import renderSummaryFor %}

{%- if answers["type_of_no_accommodation"] == "AWAITING_ASSESSMENT" -%}
{% set changeLink = "no-accommodation-2" %}
{%- else -%}
{% set changeLink = "no-accommodation" %}
{%- endif -%}

{% set accommodationSummaryHtml %}
<dl class="govuk-summary-list">
  {{ renderSummaryFor("current_accommodation", { fields: options.allFields, answers: answers, backLink: "accommodation" }) }}
  {%- if answers["type_of_no_accommodation"] != "AWAITING_ASSESSMENT" -%}
  {{ renderSummaryFor("no_accommodation_reason", { fields: options.allFields, answers: answers, backLink: changeLink }) }}
  {{ renderSummaryFor("past_accommodation_details", { fields: options.allFields, answers: answers, backLink: changeLink }) }}
  {{ renderSummaryFor("suitable_housing_planned", { fields: options.allFields, answers: answers, backLink: changeLink }) }}
  {%- endif -%}
  {{ renderSummaryFor("accommodation_changes", { fields: options.allFields, answers: answers, backLink: changeLink }) }}
</dl>
{% endset -%}

{% set practitionerAnalysisHtml %}
{% for field in form.fields %}
  {{ renderQuestion(options.fields[field], errors) }}
{% endfor %}

<div class="questiongroup-action-buttons">
  {% set saveDraftAction = action + "?action=saveDraft" %}
  {{ govukButton({
    text: "Save",
    classes: 'govuk-!-margin-bottom-3 govuk-!-margin-right-1 govuk-button--secondary',
    attributes: {
      "formaction": saveDraftAction
    }
  }) }}
  {{ govukButton({
    text: buttonText | default("Mark as complete"),
    classes: "govuk-!-margin-bottom-3 govuk-!-margin-right-1"
  }) }}
</div>
{% endset -%}

{% block formContent %}
  <form method="post" action="{{ action }}">
    <input type="hidden" name="x-csrf-token" value="{{ getCsrf() }}">
    {{ govukTabs({
      items: [
        {
          label: "Accommodation summary",
          id: "accommodation-summary",
          panel: {
            html: accommodationSummaryHtml
          }
        },
        {
          label: "Practitioner analysis",
          id: "practitioner-analysis",
          panel: {
            html: practitionerAnalysisHtml
          }
        }
      ]
    }) }}
  </form>
{% endblock %}
