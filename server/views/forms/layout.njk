{%- extends "../partials/layout.njk" -%}
{%- from "govuk/components/back-link/macro.njk" import govukBackLink -%}
{%- from "govuk/components/error-summary/macro.njk" import govukErrorSummary -%}
{%- from "govuk/components/tag/macro.njk" import govukTag -%}
{%- from "moj/components/banner/macro.njk" import mojBanner -%}

{% set mainClasses = "app-container govuk-body" %}

{% block header %}
  {% include "../partials/header.njk" %}
{% endblock %}

{% block content %}
  <div class="govuk-width-container">
    <main class="govuk-main-wrapper">
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full offender-details">
          <h3 class="govuk-heading-s">{{ subjectDetails.givenName }}
            {{ subjectDetails.familyName }}</h3>
          <dl>
            <dt>CRN:</dt>
            <dd>{{ subjectDetails.crn }}</dd>
            <dt>PNC:</dt>
            <dd>{{ subjectDetails.pnc }}</dd>
            <dt>Date of birth:</dt>
            <dd>{{ subjectDetails.dateOfBirth }}</dd>
          </dl>
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-full">
          <div class= "return-to-assessment">
            {% if assessmentIsComplete %}
              {{ govukButton({
                text: "Return to assessment",
                href: "/form/oastub/start"
              }) }}
            {% else %}
              {{ govukButton({
                text: "Return to assessment",
                classes: "govuk-button--secondary",
                href: "/form/oastub/start"
              }) }}
            {% endif %}
          </div>
          <h1 class="govuk-heading-l">{{ options.journeyPageTitle }}</h1>
          <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
        </div>
      </div>
      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-quarter">
          <nav class="moj-side-navigation side-navigation" aria-label="Side navigation">
            <ul class="moj-side-navigation__list">
              {% for link in form.navigation %}
                <li class="moj-side-navigation__item{% if link.active %} moj-side-navigation__item--active{% endif %}">
                  <a href="{{ link.url }}?action=resume"{% if link.active %} aria-current="location"{% endif %}>
                    <span class="section-label">{{ link.label }}</span>
                    {% if sectionProgress[link.section] %}
                      <span class="section-complete">âœ“</span>
                    {% endif %}
                  </a>
                </li>
              {% endfor %}
            </ul>
          </nav>
        </div>
        <div class="govuk-grid-column-three-quarters">
          {%- if backLink -%}
            {{ govukBackLink({
              text: "Back",
              href: backLink
            }) }}
          {%- endif -%}
          {%- if errors | length -%}
            {{ govukErrorSummary({
              titleText: "There is a problem",
              errorList: toErrorSummary(errors)
            }) }}
          {%- endif -%}
          {% if isSaved %}
            {{ mojBanner({
              type: 'success',
              text: 'Your progress has been saved',
              iconFallbackText: 'Success'
            }) }}
          {% endif %}
          <div class="section-heading">
            <div class="section-heading__heading">
              {%- if (form.fields | removeSectionCompleteFields).length  == 1 -%}
                <h2 class="govuk-body-l govuk-!-margin-0">{{ options.pageTitle }}</h2>
              {%- else -%}
                <h2 class="govuk-heading-l">{{ options.pageTitle }}</h2>
              {%- endif -%}
            </div>
            {% if sectionProgress[options.section] %}
              <div class="section-heading__status">
                {{ govukTag({ text: "Complete" }) }}
              </div>
            {% endif %}
          </div>
          {% block formContent %}{% endblock %}
        </div>
      </div>
    </main>
  </div>
{% endblock %}
