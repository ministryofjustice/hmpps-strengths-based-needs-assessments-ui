{% extends "../summary.njk" %}

{% macro renderAnalysisSummaryRow(label, field, yesDetailsField, noDetailsField, link) %}
  <article class="analysis-summary">
    <div class="govuk-grid-column-one-third analysis-summary__row">
      <div class="analysis-summary__label">
        {{ label }}
      </div>
    </div>
    <div class="govuk-grid-column-one-third analysis-summary__row">
      <div class="analysis-summary__value">
        <ul class="govuk-list">
          {% for option in field.options %}
            {% if option.checked %}
              {% if option.value === "YES" %}
                {% set detailsAnswer = yesDetailsField.value %}
              {% else %}
                {% set detailsAnswer = noDetailsField.value %}
              {% endif %}

              <li class="summary-details-list">
                <span class="analysis-summary__answer">{{ option.text }}</span>
                <p class="analysis__answer--secondary">{{ detailsAnswer | nl2br | safe }}</p>
              </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </div>
    {% if sessionData.user | isInEditMode %}
      <div class="govuk-grid-column-one-third analysis-summary__action">
        <a class="govuk-link" href="{{ link }}">Change<span class="govuk-visually-hidden">value for {{ label }}</span></a>
      </div>
    {% endif %}
  </article>
  <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible">
{% endmacro %}


{% block backLink %}{% endblock %}

{% block analysisPanel %}
  {% set section = options.section | replace("-", "_") %}
  {% set fields = options.allFields %}
  {% set changeLink = options.section + '-summary#practitioner-analysis' %}

  <section>
    {{ renderAnalysisSummaryRow(
      "Does " + subjectDetails.givenName + " seem motivated to stop or reduce their drug use?",
      fields["drugs_practitioner_analysis_motivated_to_stop"],
      fields[""],
      fields[""],
      changeLink
    ) }}
    {{ renderAnalysisSummaryRow(
      "Are there any strength or protective factors related to " + subjectDetails.givenName + "'s drug use?",
      fields[section + "_practitioner_analysis_strengths_or_protective_factors"],
      fields[section + "_practitioner_analysis_strengths_or_protective_factors_yes_details"],
      fields[section + "_practitioner_analysis_strengths_or_protective_factors_no_details"],
      changeLink
    ) }}
    {{ renderAnalysisSummaryRow(
      "Is "+ subjectDetails.givenName +"'s drug use inked to risk of serious harm?",
      fields[section + "_practitioner_analysis_risk_of_serious_harm"],
      fields[section + "_practitioner_analysis_risk_of_serious_harm_yes_details"],
      fields[section + "_practitioner_analysis_risk_of_serious_harm_no_details"],
      changeLink
    ) }}
    {{ renderAnalysisSummaryRow(
      "Is "+ subjectDetails.givenName +"'s drug use linked to risk of reoffending?",
      fields[section + "_practitioner_analysis_risk_of_reoffending"],
      fields[section + "_practitioner_analysis_risk_of_reoffending_yes_details"],
      fields[section + "_practitioner_analysis_risk_of_reoffending_no_details"],
      changeLink
    ) }}
  </section>
{% endblock %}
