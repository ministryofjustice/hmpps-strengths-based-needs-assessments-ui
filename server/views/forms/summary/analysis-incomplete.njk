{% extends "../layout.njk" %}
{% from "components/question/macro.njk" import renderQuestion %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% block backLink %}{% endblock %}

{% block formContent %}
  <h1>Analysis incomplete page</h1>

  <form id="form" method="post" action="{{ action }}" data-autosave="true">
    <input type="hidden" name="x-csrf-token" value="{{ getCsrf() }}">
    {% for field in getRenderedFields(form.fields, options) %}
      {% if not (field == 'drugs_practitioner_analysis_motivated_to_stop' and answers.drug_use == 'NO') %}
        {{ renderQuestion(options.fields[field], errors) }}
      {% endif %}
    {% endfor %}

    <!--
    Needs a new field to be passed in `isReadyToBeMarkedAsComplete` to use as the conditional here.
    This needs to be generated from the fieldDependencyTreeBuilder by checking all the steps where isLastStep is not true and the nextStep is not x_section_complete
    -->
    <div class="questiongroup-action-buttons">
      {{ govukButton({
        text: buttonText | default("Mark as complete"),
        classes: "govuk-!-margin-bottom-3 govuk-!-margin-right-1",
        name: getUserSubmittedField(form.fields),
        value: 'YES'
      }) }}
    </div>
  </form>
{% endblock %}
