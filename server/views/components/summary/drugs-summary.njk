{% from "./macros.njk" import renderTopLevelField %}
{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}

{%- macro renderDrugsSummary(drugUseField, sessionData, summaryFields) -%}
  {{ renderTopLevelField(drugUseField, sessionData) }}

  {% set drugsSummary = generateDrugsSummary(summaryFields.singleFields) %}

  {% set hasUsedDrugs = false %}
  {% for answer in drugUseField.answers %}
    {% if answer.value == 'YES' %}
      {% set hasUsedDrugs = true %}
    {% endif %}
  {% endfor %}

  {% if drugsSummary.usedInTheLastSix | length %}
    <h3 class="govuk-heading-m govuk-!-font-size-27">Used in the last 6 months</h3>
    {% for card in drugsSummary.usedInTheLastSix %}
      {{ govukSummaryList(card) }}
    {% endfor %}
  {% endif %}

  {% if drugsSummary.notUsedInTheLastSix | length %}
    <h3 class="govuk-heading-m govuk-!-font-size-27">Not used in the last 6 months</h3>
    {% for card in drugsSummary.notUsedInTheLastSix %}
      {{ govukSummaryList(card) }}
    {% endfor %}
  {% endif %}

  {% if hasUsedDrugs %}
    <h3 class="govuk-heading-m govuk-!-font-size-27">More information</h3>
  {% endif %}

{%- endmacro -%}
